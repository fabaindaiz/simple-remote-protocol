# Protocol

Here we will describe the protocol used by the microcontroller and the client to communicate.

## Encoding

The protocol only allows to send and receive messages in a binary format. Any encoding are responsibility of upper layers.
Protocol messages do not have a fixed size, so the client and the server must read the message until the end of the message is reached.

Messages are encrypted using AES-256 and sended in two parts separated by a `b"/r/n"` sequence and ended by a `b"/r/n/r/n"` sequence.
The first part is the encrypted message and the second part is the initialization vector used to encrypt the message.

## Secure connection

The microcontroller and the client use a secure connection based en AES-256-CTR encripted session with a shared key.
The key is generated by the microcontroller and exchanged with the client using RSA-2048 encryption with PKCS#1 v1.5 padding.

## Security notice

The old PKCS#1 v1.5 padding is used due to the limitations of the microcontroller RSA library.
This padding is vulnerable to Bleichenbacher's attack and should be replaced by OAEP padding in the future.
